#!/user/bin/env groovy
@Library('shared-library-nodejs')
def gv

pipeline {
    agent any
    tools {
        nodejs "node"
    }
    stages {
        stage("init") {
              steps {
                    script {
                        gv = load "app/script.groovy"
                    }
                }
            }

        stage("increment version") {
            steps {
                script {
           dir("app") {
                       increment()
                    }
                }
            }
        }

        stage("Run tests") {
            steps {
                script {
                    dir("app") {
                       runTest()
                    }
                }
            }
        }

        stage("Build and Push docker image") {
            steps {
               script {
                buildPushImage()
             }
           }
        }

        stage("commit version update") {
            steps {
                script {
                    gv.VersionUpdateCommit()
                    }
                }
            }
        }

   post {
           always {
               echo 'Pipeline execution complete'
           }
       }
   }